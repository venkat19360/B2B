pipeline {
    agent any

    stages {
        stage('Install Dependency Check') {
            steps {
                script {
                    // Download OWASP Dependency Check
                    sh 'curl -L https://github.com/jeremylong/DependencyCheck/releases/download/v6.5.1/dependency-check-6.5.1-release.zip -o dependency-check.zip'
                    
                    // Unzip the downloaded file
                    sh 'unzip -o dependency-check.zip -d dependency-check'
                }
            }
        }
        stage('Run Dependency Check') {
            steps {
                script {
                    // Run OWASP Dependency Check scan
                    sh './dependency-check/bin/dependency-check.sh --project "jenkinspipeline" --scan . --format "HTML" --out dependency-check-report'
                }
            }
        }
        stage('Archive Reports') {
            steps {
                // Archive the generated HTML report
                archiveArtifacts artifacts: 'dependency-check-report/*.html', allowEmptyArchive: true
            }
        }
    }

    post {
        always {
            // Clean the workspace after the pipeline is finished
            cleanWs()
        }
    }
}
